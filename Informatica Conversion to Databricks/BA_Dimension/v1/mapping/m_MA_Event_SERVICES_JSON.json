{"Edges":[{"transformationType":"Sequence","id":"e-0","source":"","target":"SEQ_MA_EVENT_ID"},{"transformationType":"Source Definition","id":"e-1","source":"","target":"SERVICES_MARGIN_RATE"},{"transformationType":"Source Definition","id":"e-2","source":"","target":"MA_EVENT"},{"transformationType":"Source Definition","id":"e-3","source":"","target":"DAYS"},{"transformationType":"Source Definition","id":"e-4","source":"","target":"SAP_DEPT"},{"transformationType":"Source Qualifier","id":"e-5","source":"SAP_DEPT","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins"},{"transformationType":"Source Qualifier","id":"e-6","source":"DAYS","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins"},{"transformationType":"Source Qualifier","id":"e-7","source":"MA_EVENT","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins"},{"transformationType":"Source Qualifier","id":"e-8","source":"SERVICES_MARGIN_RATE","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins"},{"transformationType":"Expression","id":"e-9","source":"SEQ_MA_EVENT_ID","target":"EXP_INS_UPD"},{"transformationType":"Expression","id":"e-10","source":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","target":"EXP_INS_UPD"},{"transformationType":"Source Qualifier","id":"e-11","source":"SAP_DEPT","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd"},{"transformationType":"Source Qualifier","id":"e-12","source":"DAYS","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd"},{"transformationType":"Source Qualifier","id":"e-13","source":"MA_EVENT","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd"},{"transformationType":"Source Qualifier","id":"e-14","source":"SERVICES_MARGIN_RATE","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd"},{"transformationType":"Expression","id":"e-15","source":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","target":"EXP_UPD"},{"transformationType":"Custom Transformation","id":"e-16","source":"EXP_UPD","target":"UNI_SERVICES_MARGIN_RATE"},{"transformationType":"Custom Transformation","id":"e-17","source":"EXP_INS_UPD","target":"UNI_SERVICES_MARGIN_RATE"},{"transformationType":"Update Strategy","id":"e-18","source":"UNI_SERVICES_MARGIN_RATE","target":"UPD_STRATEGY"},{"transformationType":"Expression","id":"e-19","source":"UNI_SERVICES_MARGIN_RATE","target":"EXP_INS"},{"transformationType":"Target Definition","id":"e-20","source":"EXP_INS","target":"MA_EVENT_RESTATE_HIST"},{"transformationType":"Target Definition","id":"e-21","source":"UPD_STRATEGY","target":"MA_EVENT"}],"Nodes":[{"data":{"transformationType":"Sequence","label":"SEQ_MA_EVENT_ID","queries":["spark.sql(\"\"\"CREATE TABLE SEQ_MA_EVENT_ID(NEXTVAL BIGINT,\nCURRVAL BIGINT,\nIncrement_By Int);\"\"\")","spark.sql(\"\"\"INSERT INTO SEQ_MA_EVENT_ID(NEXTVAL BIGINT,\nCURRVAL BIGINT,\nIncrement_By Int) VALUES(2, 1, 1)\"\"\")"]},"id":"SEQ_MA_EVENT_ID","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Definition","label":"SERVICES_MARGIN_RATE","queries":["df_1=spark.sql(\"\"\"\n    SELECT\n        WEEK_DT AS WEEK_DT,\n        LOCATION_ID AS LOCATION_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        MARGIN_RATE AS MARGIN_RATE,\n        UPDATE_TSTMP AS UPDATE_TSTMP,\n        LOAD_TSTMP AS LOAD_TSTMP,\n        monotonically_increasing_id() AS Monotonically_Increasing_Id \n    FROM\n        SERVICES_MARGIN_RATE\"\"\")","df_1.createOrReplaceTempView(\"SERVICES_MARGIN_RATE_1\")"]},"id":"SERVICES_MARGIN_RATE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Definition","label":"MA_EVENT","queries":["df_2=spark.sql(\"\"\"\n    SELECT\n        MA_EVENT_ID AS MA_EVENT_ID,\n        OFFER_ID AS OFFER_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        PRODUCT_ID AS PRODUCT_ID,\n        COUNTRY_CD AS COUNTRY_CD,\n        START_DT AS START_DT,\n        END_DT AS END_DT,\n        MA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\n        MA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\n        LOCATION_ID AS LOCATION_ID,\n        MOVEMENT_ID AS MOVEMENT_ID,\n        VALUATION_CLASS_CD AS VALUATION_CLASS_CD,\n        GL_ACCT_NBR AS GL_ACCT_NBR,\n        LOCATION_TYPE_ID AS LOCATION_TYPE_ID,\n        ROYALTY_BRAND_ID AS ROYALTY_BRAND_ID,\n        BRAND_CD AS BRAND_CD,\n        MA_FORMULA_CD AS MA_FORMULA_CD,\n        FISCAL_MO AS FISCAL_MO,\n        SAP_CATEGORY_ID AS SAP_CATEGORY_ID,\n        FROM_LOCATION_ID AS FROM_LOCATION_ID,\n        SOURCE_VENDOR_ID AS SOURCE_VENDOR_ID,\n        COMPANY_ID AS COMPANY_ID,\n        MA_EVENT_DESC AS MA_EVENT_DESC,\n        EM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\n        EM_COMMENT AS EM_COMMENT,\n        EM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\n        EM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\n        EM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\n        EM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\n        EM_VENDOR_ID AS EM_VENDOR_ID,\n        EM_VENDOR_NAME AS EM_VENDOR_NAME,\n        EM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\n        VENDOR_NAME_TXT AS VENDOR_NAME_TXT,\n        MA_PCT_IND AS MA_PCT_IND,\n        MA_AMT AS MA_AMT,\n        MA_MAX_AMT AS MA_MAX_AMT,\n        UPDATE_DT AS UPDATE_DT,\n        LOAD_DT AS LOAD_DT,\n        monotonically_increasing_id() AS Monotonically_Increasing_Id \n    FROM\n        MA_EVENT\"\"\")","df_2.createOrReplaceTempView(\"MA_EVENT_2\")"]},"id":"MA_EVENT","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Definition","label":"DAYS","queries":["df_3=spark.sql(\"\"\"\n    SELECT\n        DAY_DT AS DAY_DT,\n        BUSINESS_DAY_FLAG AS BUSINESS_DAY_FLAG,\n        HOLIDAY_FLAG AS HOLIDAY_FLAG,\n        DAY_OF_WK_NAME AS DAY_OF_WK_NAME,\n        DAY_OF_WK_NAME_ABBR AS DAY_OF_WK_NAME_ABBR,\n        DAY_OF_WK_NBR AS DAY_OF_WK_NBR,\n        CAL_DAY_OF_MO_NBR AS CAL_DAY_OF_MO_NBR,\n        CAL_DAY_OF_YR_NBR AS CAL_DAY_OF_YR_NBR,\n        CAL_WK AS CAL_WK,\n        CAL_WK_NBR AS CAL_WK_NBR,\n        CAL_MO AS CAL_MO,\n        CAL_MO_NBR AS CAL_MO_NBR,\n        CAL_MO_NAME AS CAL_MO_NAME,\n        CAL_MO_NAME_ABBR AS CAL_MO_NAME_ABBR,\n        CAL_QTR AS CAL_QTR,\n        CAL_QTR_NBR AS CAL_QTR_NBR,\n        CAL_HALF AS CAL_HALF,\n        CAL_YR AS CAL_YR,\n        FISCAL_DAY_OF_MO_NBR AS FISCAL_DAY_OF_MO_NBR,\n        FISCAL_DAY_OF_YR_NBR AS FISCAL_DAY_OF_YR_NBR,\n        FISCAL_WK AS FISCAL_WK,\n        FISCAL_WK_NBR AS FISCAL_WK_NBR,\n        FISCAL_MO AS FISCAL_MO,\n        FISCAL_MO_NBR AS FISCAL_MO_NBR,\n        FISCAL_MO_NAME AS FISCAL_MO_NAME,\n        FISCAL_MO_NAME_ABBR AS FISCAL_MO_NAME_ABBR,\n        FISCAL_QTR AS FISCAL_QTR,\n        FISCAL_QTR_NBR AS FISCAL_QTR_NBR,\n        FISCAL_HALF AS FISCAL_HALF,\n        FISCAL_YR AS FISCAL_YR,\n        LYR_WEEK_DT AS LYR_WEEK_DT,\n        LWK_WEEK_DT AS LWK_WEEK_DT,\n        WEEK_DT AS WEEK_DT,\n        EST_TIME_CONV_AMT AS EST_TIME_CONV_AMT,\n        EST_TIME_CONV_HRS AS EST_TIME_CONV_HRS,\n        ES0_TIME_CONV_AMT AS ES0_TIME_CONV_AMT,\n        ES0_TIME_CONV_HRS AS ES0_TIME_CONV_HRS,\n        CST_TIME_CONV_AMT AS CST_TIME_CONV_AMT,\n        CST_TIME_CONV_HRS AS CST_TIME_CONV_HRS,\n        CS0_TIME_CONV_AMT AS CS0_TIME_CONV_AMT,\n        CS0_TIME_CONV_HRS AS CS0_TIME_CONV_HRS,\n        MST_TIME_CONV_AMT AS MST_TIME_CONV_AMT,\n        MST_TIME_CONV_HRS AS MST_TIME_CONV_HRS,\n        MS0_TIME_CONV_AMT AS MS0_TIME_CONV_AMT,\n        MS0_TIME_CONV_HRS AS MS0_TIME_CONV_HRS,\n        PST_TIME_CONV_AMT AS PST_TIME_CONV_AMT,\n        PST_TIME_CONV_HRS AS PST_TIME_CONV_HRS,\n        monotonically_increasing_id() AS Monotonically_Increasing_Id \n    FROM\n        DAYS\"\"\")","df_3.createOrReplaceTempView(\"DAYS_3\")"]},"id":"DAYS","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Definition","label":"SAP_DEPT","queries":["df_4=spark.sql(\"\"\"\n    SELECT\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        SAP_DEPT_DESC AS SAP_DEPT_DESC,\n        SAP_DIVISION_ID AS SAP_DIVISION_ID,\n        MERCH_DIVISIONAL_ID AS MERCH_DIVISIONAL_ID,\n        BUYER_ID AS BUYER_ID,\n        monotonically_increasing_id() AS Monotonically_Increasing_Id \n    FROM\n        SAP_DEPT\"\"\")","df_4.createOrReplaceTempView(\"SAP_DEPT_4\")"]},"id":"SAP_DEPT","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","queries":["df_5=spark.sql(\"\"\"\n    SELECT\n        NULL AS OFFER_ID,\n        S.SAP_DEPT_ID,\n        NULL AS PRODUCT_ID,\n        NULL AS COUNTRY_CD,\n        W.START_DT,\n        W.END_DT,\n        30 AS MA_EVENT_TYPE_ID,\n        7 AS MA_EVENT_SOURCE_ID,\n        S.LOCATION_ID,\n        'Services Margin - ' || TRIM(SAP_DEPT_DESC) || ' - Week=' || TO_CHAR(S.WEEK_DT,\n        'MM/DD/YYYY') || ' - Location ID=' || S.LOCATION_ID AS MA_EVENT_DESC,\n        NULL AS EM_VENDOR_FUNDING_ID,\n        NULL AS EM_COMMENT,\n        NULL AS EM_BILL_ALT_VENDOR_FLAG,\n        NULL AS EM_ALT_VENDOR_ID,\n        NULL AS EM_ALT_VENDOR_NAME,\n        NULL AS EM_ALT_VENDOR_COUNTRY_CD,\n        NULL AS EM_VENDOR_ID,\n        NULL AS EM_VENDOR_NAME,\n        NULL AS EM_VENDOR_COUNTRY_CD,\n        NULL AS VENDOR_NAME_TXT,\n        1 AS MA_PCT_IND,\n        S.MARGIN_RATE * 100 * -1 AS MA_AMT,\n        NULL AS MA_MAX_AMT,\n        'I' AS LOAD_FLAG \n    FROM\n        SERVICES_MARGIN_RATE S \n    JOIN\n        SAP_DEPT D \n            ON S.SAP_DEPT_ID = D.SAP_DEPT_ID \n    JOIN\n        (\n            SELECT\n                WEEK_DT,\n                MIN(DAY_DT) AS START_DT,\n                MAX(DAY_DT) AS END_DT \n            FROM\n                DAYS \n            WHERE\n                CAL_YR >= 2014 \n            GROUP BY\n                WEEK_DT\n        ) W \n            ON S.WEEK_DT = W.WEEK_DT \n    LEFT JOIN\n        MA_EVENT M \n            ON S.LOCATION_ID = M.LOCATION_ID \n            AND S.SAP_DEPT_ID = M.SAP_DEPT_ID \n            AND W.START_DT = M.START_DT \n            AND W.END_DT = M.END_DT \n            AND M.MA_EVENT_TYPE_ID = 30 \n            AND M.MA_EVENT_SOURCE_ID = 7 \n    WHERE\n        S.UPDATE_TSTMP > CURRENT_DATE - 2 \n        AND M.MA_EVENT_ID IS NULL\"\"\")","df_5.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","queries":["df_5=spark.sql(\"\"\"\n    SELECT\n        NULL AS OFFER_ID,\n        S.SAP_DEPT_ID,\n        NULL AS PRODUCT_ID,\n        NULL AS COUNTRY_CD,\n        W.START_DT,\n        W.END_DT,\n        30 AS MA_EVENT_TYPE_ID,\n        7 AS MA_EVENT_SOURCE_ID,\n        S.LOCATION_ID,\n        'Services Margin - ' || TRIM(SAP_DEPT_DESC) || ' - Week=' || TO_CHAR(S.WEEK_DT,\n        'MM/DD/YYYY') || ' - Location ID=' || S.LOCATION_ID AS MA_EVENT_DESC,\n        NULL AS EM_VENDOR_FUNDING_ID,\n        NULL AS EM_COMMENT,\n        NULL AS EM_BILL_ALT_VENDOR_FLAG,\n        NULL AS EM_ALT_VENDOR_ID,\n        NULL AS EM_ALT_VENDOR_NAME,\n        NULL AS EM_ALT_VENDOR_COUNTRY_CD,\n        NULL AS EM_VENDOR_ID,\n        NULL AS EM_VENDOR_NAME,\n        NULL AS EM_VENDOR_COUNTRY_CD,\n        NULL AS VENDOR_NAME_TXT,\n        1 AS MA_PCT_IND,\n        S.MARGIN_RATE * 100 * -1 AS MA_AMT,\n        NULL AS MA_MAX_AMT,\n        'I' AS LOAD_FLAG \n    FROM\n        SERVICES_MARGIN_RATE S \n    JOIN\n        SAP_DEPT D \n            ON S.SAP_DEPT_ID = D.SAP_DEPT_ID \n    JOIN\n        (\n            SELECT\n                WEEK_DT,\n                MIN(DAY_DT) AS START_DT,\n                MAX(DAY_DT) AS END_DT \n            FROM\n                DAYS \n            WHERE\n                CAL_YR >= 2014 \n            GROUP BY\n                WEEK_DT\n        ) W \n            ON S.WEEK_DT = W.WEEK_DT \n    LEFT JOIN\n        MA_EVENT M \n            ON S.LOCATION_ID = M.LOCATION_ID \n            AND S.SAP_DEPT_ID = M.SAP_DEPT_ID \n            AND W.START_DT = M.START_DT \n            AND W.END_DT = M.END_DT \n            AND M.MA_EVENT_TYPE_ID = 30 \n            AND M.MA_EVENT_SOURCE_ID = 7 \n    WHERE\n        S.UPDATE_TSTMP > CURRENT_DATE - 2 \n        AND M.MA_EVENT_ID IS NULL\"\"\")","df_5.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","queries":["df_5=spark.sql(\"\"\"\n    SELECT\n        NULL AS OFFER_ID,\n        S.SAP_DEPT_ID,\n        NULL AS PRODUCT_ID,\n        NULL AS COUNTRY_CD,\n        W.START_DT,\n        W.END_DT,\n        30 AS MA_EVENT_TYPE_ID,\n        7 AS MA_EVENT_SOURCE_ID,\n        S.LOCATION_ID,\n        'Services Margin - ' || TRIM(SAP_DEPT_DESC) || ' - Week=' || TO_CHAR(S.WEEK_DT,\n        'MM/DD/YYYY') || ' - Location ID=' || S.LOCATION_ID AS MA_EVENT_DESC,\n        NULL AS EM_VENDOR_FUNDING_ID,\n        NULL AS EM_COMMENT,\n        NULL AS EM_BILL_ALT_VENDOR_FLAG,\n        NULL AS EM_ALT_VENDOR_ID,\n        NULL AS EM_ALT_VENDOR_NAME,\n        NULL AS EM_ALT_VENDOR_COUNTRY_CD,\n        NULL AS EM_VENDOR_ID,\n        NULL AS EM_VENDOR_NAME,\n        NULL AS EM_VENDOR_COUNTRY_CD,\n        NULL AS VENDOR_NAME_TXT,\n        1 AS MA_PCT_IND,\n        S.MARGIN_RATE * 100 * -1 AS MA_AMT,\n        NULL AS MA_MAX_AMT,\n        'I' AS LOAD_FLAG \n    FROM\n        SERVICES_MARGIN_RATE S \n    JOIN\n        SAP_DEPT D \n            ON S.SAP_DEPT_ID = D.SAP_DEPT_ID \n    JOIN\n        (\n            SELECT\n                WEEK_DT,\n                MIN(DAY_DT) AS START_DT,\n                MAX(DAY_DT) AS END_DT \n            FROM\n                DAYS \n            WHERE\n                CAL_YR >= 2014 \n            GROUP BY\n                WEEK_DT\n        ) W \n            ON S.WEEK_DT = W.WEEK_DT \n    LEFT JOIN\n        MA_EVENT M \n            ON S.LOCATION_ID = M.LOCATION_ID \n            AND S.SAP_DEPT_ID = M.SAP_DEPT_ID \n            AND W.START_DT = M.START_DT \n            AND W.END_DT = M.END_DT \n            AND M.MA_EVENT_TYPE_ID = 30 \n            AND M.MA_EVENT_SOURCE_ID = 7 \n    WHERE\n        S.UPDATE_TSTMP > CURRENT_DATE - 2 \n        AND M.MA_EVENT_ID IS NULL\"\"\")","df_5.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","queries":["df_5=spark.sql(\"\"\"\n    SELECT\n        NULL AS OFFER_ID,\n        S.SAP_DEPT_ID,\n        NULL AS PRODUCT_ID,\n        NULL AS COUNTRY_CD,\n        W.START_DT,\n        W.END_DT,\n        30 AS MA_EVENT_TYPE_ID,\n        7 AS MA_EVENT_SOURCE_ID,\n        S.LOCATION_ID,\n        'Services Margin - ' || TRIM(SAP_DEPT_DESC) || ' - Week=' || TO_CHAR(S.WEEK_DT,\n        'MM/DD/YYYY') || ' - Location ID=' || S.LOCATION_ID AS MA_EVENT_DESC,\n        NULL AS EM_VENDOR_FUNDING_ID,\n        NULL AS EM_COMMENT,\n        NULL AS EM_BILL_ALT_VENDOR_FLAG,\n        NULL AS EM_ALT_VENDOR_ID,\n        NULL AS EM_ALT_VENDOR_NAME,\n        NULL AS EM_ALT_VENDOR_COUNTRY_CD,\n        NULL AS EM_VENDOR_ID,\n        NULL AS EM_VENDOR_NAME,\n        NULL AS EM_VENDOR_COUNTRY_CD,\n        NULL AS VENDOR_NAME_TXT,\n        1 AS MA_PCT_IND,\n        S.MARGIN_RATE * 100 * -1 AS MA_AMT,\n        NULL AS MA_MAX_AMT,\n        'I' AS LOAD_FLAG \n    FROM\n        SERVICES_MARGIN_RATE S \n    JOIN\n        SAP_DEPT D \n            ON S.SAP_DEPT_ID = D.SAP_DEPT_ID \n    JOIN\n        (\n            SELECT\n                WEEK_DT,\n                MIN(DAY_DT) AS START_DT,\n                MAX(DAY_DT) AS END_DT \n            FROM\n                DAYS \n            WHERE\n                CAL_YR >= 2014 \n            GROUP BY\n                WEEK_DT\n        ) W \n            ON S.WEEK_DT = W.WEEK_DT \n    LEFT JOIN\n        MA_EVENT M \n            ON S.LOCATION_ID = M.LOCATION_ID \n            AND S.SAP_DEPT_ID = M.SAP_DEPT_ID \n            AND W.START_DT = M.START_DT \n            AND W.END_DT = M.END_DT \n            AND M.MA_EVENT_TYPE_ID = 30 \n            AND M.MA_EVENT_SOURCE_ID = 7 \n    WHERE\n        S.UPDATE_TSTMP > CURRENT_DATE - 2 \n        AND M.MA_EVENT_ID IS NULL\"\"\")","df_5.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Expression","label":"EXP_INS_UPD","queries":["df_6=spark.sql(\"\"\"\n    SELECT\n        (ROW_NUMBER() OVER (\n    ORDER BY\n        (SELECT\n            NULL)) - 1) * (SELECT\n            Increment_By \n        FROM\n            SEQ_MA_EVENT_ID) + (SELECT\n            NEXTVAL \n        FROM\n            SEQ_MA_EVENT_ID) AS MA_EVENT_ID,\n        SEQ_MA_EVENT_ID.NEXTVAL AS MA_EVENT_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.OFFER_ID AS OFFER_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.SAP_DEPT_ID AS SAP_DEPT_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.PRODUCT_ID AS PRODUCT_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.COUNTRY_CD AS COUNTRY_CD,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.START_DT AS START_DT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.END_DT AS END_DT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.LOCATION_ID AS LOCATION_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_EVENT_DESC AS MA_EVENT_DESC,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_COMMENT AS EM_COMMENT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_VENDOR_ID AS EM_VENDOR_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_VENDOR_NAME AS EM_VENDOR_NAME,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.VENDOR_NAME_TXT AS VENDOR_NAME_TXT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_PCT_IND AS MA_PCT_IND,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_AMT AS MA_AMT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_MAX_AMT AS MA_MAX_AMT,\n        current_timestamp AS UPDATE_DT,\n        current_timestamp AS LOAD_DT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.LOAD_FLAG AS LOAD_FLAG,\n        SEQ_MA_EVENT_ID.Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        SEQ_MA_EVENT_ID \n    INNER JOIN\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5 \n            ON SEQ_MA_EVENT_ID.Monotonically_Increasing_Id = SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.Monotonically_Increasing_Id\"\"\")","df_6.createOrReplaceTempView(\"EXP_INS_UPD_6\")","spark.sql(\"\"\"UPDATE SEQ_MA_EVENT_ID SET CURRVAL = (SELECT MAX(MA_EVENT_ID) FROM EXP_INS_UPD_6) , NEXTVAL = (SELECT MAX(MA_EVENT_ID) FROM EXP_INS_UPD_6) + (SELECT Increment_By FROM EXP_INS_UPD_6)\"\"\")"]},"id":"EXP_INS_UPD","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Expression","label":"EXP_INS_UPD","queries":["df_6=spark.sql(\"\"\"\n    SELECT\n        (ROW_NUMBER() OVER (\n    ORDER BY\n        (SELECT\n            NULL)) - 1) * (SELECT\n            Increment_By \n        FROM\n            SEQ_MA_EVENT_ID) + (SELECT\n            NEXTVAL \n        FROM\n            SEQ_MA_EVENT_ID) AS MA_EVENT_ID,\n        SEQ_MA_EVENT_ID.NEXTVAL AS MA_EVENT_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.OFFER_ID AS OFFER_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.SAP_DEPT_ID AS SAP_DEPT_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.PRODUCT_ID AS PRODUCT_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.COUNTRY_CD AS COUNTRY_CD,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.START_DT AS START_DT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.END_DT AS END_DT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.LOCATION_ID AS LOCATION_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_EVENT_DESC AS MA_EVENT_DESC,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_COMMENT AS EM_COMMENT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_VENDOR_ID AS EM_VENDOR_ID,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_VENDOR_NAME AS EM_VENDOR_NAME,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.EM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.VENDOR_NAME_TXT AS VENDOR_NAME_TXT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_PCT_IND AS MA_PCT_IND,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_AMT AS MA_AMT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.MA_MAX_AMT AS MA_MAX_AMT,\n        current_timestamp AS UPDATE_DT,\n        current_timestamp AS LOAD_DT,\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.LOAD_FLAG AS LOAD_FLAG,\n        SEQ_MA_EVENT_ID.Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        SEQ_MA_EVENT_ID \n    INNER JOIN\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5 \n            ON SEQ_MA_EVENT_ID.Monotonically_Increasing_Id = SQ_Shortcut_to_SERVICES_MARGIN_RATE_Ins_5.Monotonically_Increasing_Id\"\"\")","df_6.createOrReplaceTempView(\"EXP_INS_UPD_6\")","spark.sql(\"\"\"UPDATE SEQ_MA_EVENT_ID SET CURRVAL = (SELECT MAX(MA_EVENT_ID) FROM EXP_INS_UPD_6) , NEXTVAL = (SELECT MAX(MA_EVENT_ID) FROM EXP_INS_UPD_6) + (SELECT Increment_By FROM EXP_INS_UPD_6)\"\"\")"]},"id":"EXP_INS_UPD","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","queries":["df_7=spark.sql(\"\"\"\n    SELECT\n        M.MA_EVENT_ID,\n        NULL AS OFFER_ID,\n        M.SAP_DEPT_ID,\n        NULL AS PRODUCT_ID,\n        NULL AS COUNTRY_CD,\n        M.START_DT,\n        M.END_DT,\n        M.MA_EVENT_TYPE_ID,\n        M.MA_EVENT_SOURCE_ID,\n        M.LOCATION_ID,\n        M.MA_EVENT_DESC,\n        NULL AS EM_VENDOR_FUNDING_ID,\n        NULL AS EM_COMMENT,\n        NULL AS EM_BILL_ALT_VENDOR_FLAG,\n        NULL AS EM_ALT_VENDOR_ID,\n        NULL AS EM_ALT_VENDOR_NAME,\n        NULL AS EM_ALT_VENDOR_COUNTRY_CD,\n        NULL AS EM_VENDOR_ID,\n        NULL AS EM_VENDOR_NAME,\n        NULL AS EM_VENDOR_COUNTRY_CD,\n        NULL AS VENDOR_NAME_TXT,\n        M.MA_PCT_IND,\n        S.MARGIN_RATE * 100 * -1 AS MA_AMT,\n        NULL AS MA_MAX_AMT,\n        M.LOAD_DT,\n        'R' AS LOAD_FLAG \n    FROM\n        SERVICES_MARGIN_RATE S \n    JOIN\n        SAP_DEPT D \n            ON S.SAP_DEPT_ID = D.SAP_DEPT_ID \n    JOIN\n        (\n            SELECT\n                WEEK_DT,\n                MIN(DAY_DT) AS START_DT,\n                MAX(DAY_DT) AS END_DT \n            FROM\n                DAYS \n            WHERE\n                CAL_YR >= 2014 \n            GROUP BY\n                WEEK_DT\n        ) W \n            ON S.WEEK_DT = W.WEEK_DT \n    JOIN\n        MA_EVENT M \n            ON S.LOCATION_ID = M.LOCATION_ID \n            AND S.SAP_DEPT_ID = M.SAP_DEPT_ID \n            AND W.START_DT = M.START_DT \n            AND W.END_DT = M.END_DT \n            AND M.MA_EVENT_TYPE_ID = 30 \n            AND M.MA_EVENT_SOURCE_ID = 7 \n    WHERE\n        S.UPDATE_TSTMP > CURRENT_DATE - 2 \n        AND M.MA_AMT <> S.MARGIN_RATE * 100 * -1\"\"\")","df_7.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd_7\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","queries":["df_7=spark.sql(\"\"\"\n    SELECT\n        M.MA_EVENT_ID,\n        NULL AS OFFER_ID,\n        M.SAP_DEPT_ID,\n        NULL AS PRODUCT_ID,\n        NULL AS COUNTRY_CD,\n        M.START_DT,\n        M.END_DT,\n        M.MA_EVENT_TYPE_ID,\n        M.MA_EVENT_SOURCE_ID,\n        M.LOCATION_ID,\n        M.MA_EVENT_DESC,\n        NULL AS EM_VENDOR_FUNDING_ID,\n        NULL AS EM_COMMENT,\n        NULL AS EM_BILL_ALT_VENDOR_FLAG,\n        NULL AS EM_ALT_VENDOR_ID,\n        NULL AS EM_ALT_VENDOR_NAME,\n        NULL AS EM_ALT_VENDOR_COUNTRY_CD,\n        NULL AS EM_VENDOR_ID,\n        NULL AS EM_VENDOR_NAME,\n        NULL AS EM_VENDOR_COUNTRY_CD,\n        NULL AS VENDOR_NAME_TXT,\n        M.MA_PCT_IND,\n        S.MARGIN_RATE * 100 * -1 AS MA_AMT,\n        NULL AS MA_MAX_AMT,\n        M.LOAD_DT,\n        'R' AS LOAD_FLAG \n    FROM\n        SERVICES_MARGIN_RATE S \n    JOIN\n        SAP_DEPT D \n            ON S.SAP_DEPT_ID = D.SAP_DEPT_ID \n    JOIN\n        (\n            SELECT\n                WEEK_DT,\n                MIN(DAY_DT) AS START_DT,\n                MAX(DAY_DT) AS END_DT \n            FROM\n                DAYS \n            WHERE\n                CAL_YR >= 2014 \n            GROUP BY\n                WEEK_DT\n        ) W \n            ON S.WEEK_DT = W.WEEK_DT \n    JOIN\n        MA_EVENT M \n            ON S.LOCATION_ID = M.LOCATION_ID \n            AND S.SAP_DEPT_ID = M.SAP_DEPT_ID \n            AND W.START_DT = M.START_DT \n            AND W.END_DT = M.END_DT \n            AND M.MA_EVENT_TYPE_ID = 30 \n            AND M.MA_EVENT_SOURCE_ID = 7 \n    WHERE\n        S.UPDATE_TSTMP > CURRENT_DATE - 2 \n        AND M.MA_AMT <> S.MARGIN_RATE * 100 * -1\"\"\")","df_7.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd_7\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","queries":["df_7=spark.sql(\"\"\"\n    SELECT\n        M.MA_EVENT_ID,\n        NULL AS OFFER_ID,\n        M.SAP_DEPT_ID,\n        NULL AS PRODUCT_ID,\n        NULL AS COUNTRY_CD,\n        M.START_DT,\n        M.END_DT,\n        M.MA_EVENT_TYPE_ID,\n        M.MA_EVENT_SOURCE_ID,\n        M.LOCATION_ID,\n        M.MA_EVENT_DESC,\n        NULL AS EM_VENDOR_FUNDING_ID,\n        NULL AS EM_COMMENT,\n        NULL AS EM_BILL_ALT_VENDOR_FLAG,\n        NULL AS EM_ALT_VENDOR_ID,\n        NULL AS EM_ALT_VENDOR_NAME,\n        NULL AS EM_ALT_VENDOR_COUNTRY_CD,\n        NULL AS EM_VENDOR_ID,\n        NULL AS EM_VENDOR_NAME,\n        NULL AS EM_VENDOR_COUNTRY_CD,\n        NULL AS VENDOR_NAME_TXT,\n        M.MA_PCT_IND,\n        S.MARGIN_RATE * 100 * -1 AS MA_AMT,\n        NULL AS MA_MAX_AMT,\n        M.LOAD_DT,\n        'R' AS LOAD_FLAG \n    FROM\n        SERVICES_MARGIN_RATE S \n    JOIN\n        SAP_DEPT D \n            ON S.SAP_DEPT_ID = D.SAP_DEPT_ID \n    JOIN\n        (\n            SELECT\n                WEEK_DT,\n                MIN(DAY_DT) AS START_DT,\n                MAX(DAY_DT) AS END_DT \n            FROM\n                DAYS \n            WHERE\n                CAL_YR >= 2014 \n            GROUP BY\n                WEEK_DT\n        ) W \n            ON S.WEEK_DT = W.WEEK_DT \n    JOIN\n        MA_EVENT M \n            ON S.LOCATION_ID = M.LOCATION_ID \n            AND S.SAP_DEPT_ID = M.SAP_DEPT_ID \n            AND W.START_DT = M.START_DT \n            AND W.END_DT = M.END_DT \n            AND M.MA_EVENT_TYPE_ID = 30 \n            AND M.MA_EVENT_SOURCE_ID = 7 \n    WHERE\n        S.UPDATE_TSTMP > CURRENT_DATE - 2 \n        AND M.MA_AMT <> S.MARGIN_RATE * 100 * -1\"\"\")","df_7.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd_7\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","queries":["df_7=spark.sql(\"\"\"\n    SELECT\n        M.MA_EVENT_ID,\n        NULL AS OFFER_ID,\n        M.SAP_DEPT_ID,\n        NULL AS PRODUCT_ID,\n        NULL AS COUNTRY_CD,\n        M.START_DT,\n        M.END_DT,\n        M.MA_EVENT_TYPE_ID,\n        M.MA_EVENT_SOURCE_ID,\n        M.LOCATION_ID,\n        M.MA_EVENT_DESC,\n        NULL AS EM_VENDOR_FUNDING_ID,\n        NULL AS EM_COMMENT,\n        NULL AS EM_BILL_ALT_VENDOR_FLAG,\n        NULL AS EM_ALT_VENDOR_ID,\n        NULL AS EM_ALT_VENDOR_NAME,\n        NULL AS EM_ALT_VENDOR_COUNTRY_CD,\n        NULL AS EM_VENDOR_ID,\n        NULL AS EM_VENDOR_NAME,\n        NULL AS EM_VENDOR_COUNTRY_CD,\n        NULL AS VENDOR_NAME_TXT,\n        M.MA_PCT_IND,\n        S.MARGIN_RATE * 100 * -1 AS MA_AMT,\n        NULL AS MA_MAX_AMT,\n        M.LOAD_DT,\n        'R' AS LOAD_FLAG \n    FROM\n        SERVICES_MARGIN_RATE S \n    JOIN\n        SAP_DEPT D \n            ON S.SAP_DEPT_ID = D.SAP_DEPT_ID \n    JOIN\n        (\n            SELECT\n                WEEK_DT,\n                MIN(DAY_DT) AS START_DT,\n                MAX(DAY_DT) AS END_DT \n            FROM\n                DAYS \n            WHERE\n                CAL_YR >= 2014 \n            GROUP BY\n                WEEK_DT\n        ) W \n            ON S.WEEK_DT = W.WEEK_DT \n    JOIN\n        MA_EVENT M \n            ON S.LOCATION_ID = M.LOCATION_ID \n            AND S.SAP_DEPT_ID = M.SAP_DEPT_ID \n            AND W.START_DT = M.START_DT \n            AND W.END_DT = M.END_DT \n            AND M.MA_EVENT_TYPE_ID = 30 \n            AND M.MA_EVENT_SOURCE_ID = 7 \n    WHERE\n        S.UPDATE_TSTMP > CURRENT_DATE - 2 \n        AND M.MA_AMT <> S.MARGIN_RATE * 100 * -1\"\"\")","df_7.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd_7\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Expression","label":"EXP_UPD","queries":["df_8=spark.sql(\"\"\"\n    SELECT\n        MA_EVENT_ID AS MA_EVENT_ID,\n        OFFER_ID AS OFFER_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        PRODUCT_ID AS PRODUCT_ID,\n        COUNTRY_CD AS COUNTRY_CD,\n        START_DT AS START_DT,\n        END_DT AS END_DT,\n        MA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\n        MA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\n        LOCATION_ID AS LOCATION_ID,\n        MA_EVENT_DESC AS MA_EVENT_DESC,\n        EM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\n        EM_COMMENT AS EM_COMMENT,\n        EM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\n        EM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\n        EM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\n        EM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\n        EM_VENDOR_ID AS EM_VENDOR_ID,\n        EM_VENDOR_NAME AS EM_VENDOR_NAME,\n        EM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\n        VENDOR_NAME_TXT AS VENDOR_NAME_TXT,\n        MA_PCT_IND AS MA_PCT_IND,\n        MA_AMT AS MA_AMT,\n        MA_MAX_AMT AS MA_MAX_AMT,\n        current_timestamp AS UPDATE_DT,\n        LOAD_DT AS LOAD_DT,\n        LOAD_FLAG AS LOAD_FLAG,\n        Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_Upd_7\"\"\")","df_8.createOrReplaceTempView(\"EXP_UPD_8\")"]},"id":"EXP_UPD","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Custom Transformation","label":"UNI_SERVICES_MARGIN_RATE","queries":["df_9=spark.sql(\"\"\"SELECT COUNTRY_CD AS COUNTRY_CD,\nEM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\nEM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\nEM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\nEM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\nEM_COMMENT AS EM_COMMENT,\nEM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\nEM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\nEM_VENDOR_ID AS EM_VENDOR_ID,\nEM_VENDOR_NAME AS EM_VENDOR_NAME,\nEND_DT AS END_DT,\nLOAD_DT AS LOAD_DT,\nLOAD_FLAG AS LOAD_FLAG,\nLOCATION_ID AS LOCATION_ID,\nMA_AMT AS MA_AMT,\nMA_EVENT_DESC AS MA_EVENT_DESC,\nMA_EVENT_ID AS MA_EVENT_ID,\nMA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\nMA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\nMA_MAX_AMT AS MA_MAX_AMT,\nMA_PCT_IND AS MA_PCT_IND,\nMonotonically_Increasing_Id AS Monotonically_Increasing_Id,\nOFFER_ID AS OFFER_ID,\nPRODUCT_ID AS PRODUCT_ID,\nSAP_DEPT_ID AS SAP_DEPT_ID,\nSTART_DT AS START_DT,\nUPDATE_DT AS UPDATE_DT,\nVENDOR_NAME_TXT AS VENDOR_NAME_TXT FROM EXP_UPD_8 UNION ALL SELECT COUNTRY_CD AS COUNTRY_CD,\nEM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\nEM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\nEM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\nEM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\nEM_COMMENT AS EM_COMMENT,\nEM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\nEM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\nEM_VENDOR_ID AS EM_VENDOR_ID,\nEM_VENDOR_NAME AS EM_VENDOR_NAME,\nEND_DT AS END_DT,\nLOAD_DT AS LOAD_DT,\nLOAD_FLAG AS LOAD_FLAG,\nLOCATION_ID AS LOCATION_ID,\nMA_AMT AS MA_AMT,\nMA_EVENT_DESC AS MA_EVENT_DESC,\nMA_EVENT_ID AS MA_EVENT_ID,\nMA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\nMA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\nMA_MAX_AMT AS MA_MAX_AMT,\nMA_PCT_IND AS MA_PCT_IND,\nMonotonically_Increasing_Id AS Monotonically_Increasing_Id,\nOFFER_ID AS OFFER_ID,\nPRODUCT_ID AS PRODUCT_ID,\nSAP_DEPT_ID AS SAP_DEPT_ID,\nSTART_DT AS START_DT,\nUPDATE_DT AS UPDATE_DT,\nVENDOR_NAME_TXT AS VENDOR_NAME_TXT FROM EXP_INS_UPD_6\"\"\")","df_9.createOrReplaceTempView(\"UNI_SERVICES_MARGIN_RATE_9\")"]},"id":"UNI_SERVICES_MARGIN_RATE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Custom Transformation","label":"UNI_SERVICES_MARGIN_RATE","queries":["df_9=spark.sql(\"\"\"SELECT COUNTRY_CD AS COUNTRY_CD,\nEM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\nEM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\nEM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\nEM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\nEM_COMMENT AS EM_COMMENT,\nEM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\nEM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\nEM_VENDOR_ID AS EM_VENDOR_ID,\nEM_VENDOR_NAME AS EM_VENDOR_NAME,\nEND_DT AS END_DT,\nLOAD_DT AS LOAD_DT,\nLOAD_FLAG AS LOAD_FLAG,\nLOCATION_ID AS LOCATION_ID,\nMA_AMT AS MA_AMT,\nMA_EVENT_DESC AS MA_EVENT_DESC,\nMA_EVENT_ID AS MA_EVENT_ID,\nMA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\nMA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\nMA_MAX_AMT AS MA_MAX_AMT,\nMA_PCT_IND AS MA_PCT_IND,\nMonotonically_Increasing_Id AS Monotonically_Increasing_Id,\nOFFER_ID AS OFFER_ID,\nPRODUCT_ID AS PRODUCT_ID,\nSAP_DEPT_ID AS SAP_DEPT_ID,\nSTART_DT AS START_DT,\nUPDATE_DT AS UPDATE_DT,\nVENDOR_NAME_TXT AS VENDOR_NAME_TXT FROM EXP_UPD_8 UNION ALL SELECT COUNTRY_CD AS COUNTRY_CD,\nEM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\nEM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\nEM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\nEM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\nEM_COMMENT AS EM_COMMENT,\nEM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\nEM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\nEM_VENDOR_ID AS EM_VENDOR_ID,\nEM_VENDOR_NAME AS EM_VENDOR_NAME,\nEND_DT AS END_DT,\nLOAD_DT AS LOAD_DT,\nLOAD_FLAG AS LOAD_FLAG,\nLOCATION_ID AS LOCATION_ID,\nMA_AMT AS MA_AMT,\nMA_EVENT_DESC AS MA_EVENT_DESC,\nMA_EVENT_ID AS MA_EVENT_ID,\nMA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\nMA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\nMA_MAX_AMT AS MA_MAX_AMT,\nMA_PCT_IND AS MA_PCT_IND,\nMonotonically_Increasing_Id AS Monotonically_Increasing_Id,\nOFFER_ID AS OFFER_ID,\nPRODUCT_ID AS PRODUCT_ID,\nSAP_DEPT_ID AS SAP_DEPT_ID,\nSTART_DT AS START_DT,\nUPDATE_DT AS UPDATE_DT,\nVENDOR_NAME_TXT AS VENDOR_NAME_TXT FROM EXP_INS_UPD_6\"\"\")","df_9.createOrReplaceTempView(\"UNI_SERVICES_MARGIN_RATE_9\")"]},"id":"UNI_SERVICES_MARGIN_RATE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Update Strategy","label":"UPD_STRATEGY","queries":["df_10=spark.sql(\"\"\"\n    SELECT\n        MA_EVENT_ID AS MA_EVENT_ID,\n        OFFER_ID AS OFFER_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        PRODUCT_ID AS PRODUCT_ID,\n        COUNTRY_CD AS COUNTRY_CD,\n        START_DT AS START_DT,\n        END_DT AS END_DT,\n        MA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\n        MA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\n        LOCATION_ID AS LOCATION_ID,\n        MA_EVENT_DESC AS MA_EVENT_DESC,\n        EM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\n        EM_COMMENT AS EM_COMMENT,\n        EM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\n        EM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\n        EM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\n        EM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\n        EM_VENDOR_ID AS EM_VENDOR_ID,\n        EM_VENDOR_NAME AS EM_VENDOR_NAME,\n        EM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\n        VENDOR_NAME_TXT AS VENDOR_NAME_TXT,\n        MA_PCT_IND AS MA_PCT_IND,\n        MA_AMT AS MA_AMT,\n        MA_MAX_AMT AS MA_MAX_AMT,\n        UPDATE_DT AS UPDATE_DT,\n        LOAD_DT AS LOAD_DT,\n        LOAD_FLAG AS LOAD_FLAG,\n        Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        UNI_SERVICES_MARGIN_RATE_9\"\"\")","df_10.createOrReplaceTempView(\"UPD_STRATEGY_10\")"]},"id":"UPD_STRATEGY","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Expression","label":"EXP_INS","queries":["df_11=spark.sql(\"\"\"\n    SELECT\n        date_trunc('DAY',\n        current_timestamp) AS LOAD_DT,\n        MA_EVENT_ID AS MA_EVENT_ID,\n        PRODUCT_ID AS PRODUCT_ID,\n        COUNTRY_CD AS COUNTRY_CD,\n        START_DT AS START_DT,\n        END_DT AS END_DT,\n        MA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\n        MA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\n        LOCATION_ID AS LOCATION_ID,\n        MA_EVENT_DESC AS MA_EVENT_DESC,\n        EM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\n        EM_COMMENT AS EM_COMMENT,\n        EM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\n        EM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\n        EM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\n        EM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\n        EM_VENDOR_ID AS EM_VENDOR_ID,\n        EM_VENDOR_NAME AS EM_VENDOR_NAME,\n        EM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\n        MA_AMT AS MA_AMT,\n        MA_MAX_AMT AS MA_MAX_AMT,\n        IFF(LOAD_FLAG = 'R',\n        'U',\n        LOAD_FLAG) AS LOAD_FLAG,\n        Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        UNI_SERVICES_MARGIN_RATE_9\"\"\")","df_11.createOrReplaceTempView(\"EXP_INS_11\")"]},"id":"EXP_INS","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Target Definition","label":"MA_EVENT_RESTATE_HIST","queries":["spark.sql(\"\"\"INSERT INTO MA_EVENT_RESTATE_HIST SELECT LOAD_DT AS LOAD_DT,\nMA_EVENT_ID AS MA_EVENT_ID,\nOFFER_ID AS OFFER_ID,\nSAP_DEPT_ID AS SAP_DEPT_ID,\nPRODUCT_ID AS PRODUCT_ID,\nCOUNTRY_CD AS COUNTRY_CD,\nSTART_DT AS START_DT,\nEND_DT AS END_DT,\nMA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\nMA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\nLOCATION_ID AS LOCATION_ID,\nMOVEMENT_ID AS MOVEMENT_ID,\nVALUATION_CLASS_CD AS VALUATION_CLASS_CD,\nGL_ACCT_NBR AS GL_ACCT_NBR,\nLOCATION_TYPE_ID AS LOCATION_TYPE_ID,\nROYALTY_BRAND_ID AS ROYALTY_BRAND_ID,\nBRAND_CD AS BRAND_CD,\nMA_FORMULA_CD AS MA_FORMULA_CD,\nFISCAL_MO AS FISCAL_MO,\nSAP_CATEGORY_ID AS SAP_CATEGORY_ID,\nFROM_LOCATION_ID AS FROM_LOCATION_ID,\nSOURCE_VENDOR_ID AS SOURCE_VENDOR_ID,\nCOMPANY_ID AS COMPANY_ID,\nMA_EVENT_DESC AS MA_EVENT_DESC,\nEM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\nEM_COMMENT AS EM_COMMENT,\nEM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\nEM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\nEM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\nEM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\nEM_VENDOR_ID AS EM_VENDOR_ID,\nEM_VENDOR_NAME AS EM_VENDOR_NAME,\nEM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\nVENDOR_NAME_TXT AS VENDOR_NAME_TXT,\nMA_PCT_IND AS MA_PCT_IND,\nORIG_MA_AMT AS MA_AMT,\nMA_MAX_AMT AS MA_MAX_AMT,\nINS_UPD_DEL_FLAG AS INS_UPD_DEL_FLAG FROM EXP_INS_11\"\"\")"]},"id":"MA_EVENT_RESTATE_HIST","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Target Definition","label":"MA_EVENT","queries":["spark.sql(\"\"\"INSERT INTO MA_EVENT SELECT MA_EVENT_ID AS MA_EVENT_ID,\nOFFER_ID AS OFFER_ID,\nSAP_DEPT_ID AS SAP_DEPT_ID,\nPRODUCT_ID AS PRODUCT_ID,\nCOUNTRY_CD AS COUNTRY_CD,\nSTART_DT AS START_DT,\nEND_DT AS END_DT,\nMA_EVENT_TYPE_ID AS MA_EVENT_TYPE_ID,\nMA_EVENT_SOURCE_ID AS MA_EVENT_SOURCE_ID,\nLOCATION_ID AS LOCATION_ID,\nMOVEMENT_ID AS MOVEMENT_ID,\nVALUATION_CLASS_CD AS VALUATION_CLASS_CD,\nGL_ACCT_NBR AS GL_ACCT_NBR,\nLOCATION_TYPE_ID AS LOCATION_TYPE_ID,\nROYALTY_BRAND_ID AS ROYALTY_BRAND_ID,\nBRAND_CD AS BRAND_CD,\nMA_FORMULA_CD AS MA_FORMULA_CD,\nFISCAL_MO AS FISCAL_MO,\nSAP_CATEGORY_ID AS SAP_CATEGORY_ID,\nFROM_LOCATION_ID AS FROM_LOCATION_ID,\nSOURCE_VENDOR_ID AS SOURCE_VENDOR_ID,\nCOMPANY_ID AS COMPANY_ID,\nMA_EVENT_DESC AS MA_EVENT_DESC,\nEM_VENDOR_FUNDING_ID AS EM_VENDOR_FUNDING_ID,\nEM_COMMENT AS EM_COMMENT,\nEM_BILL_ALT_VENDOR_FLAG AS EM_BILL_ALT_VENDOR_FLAG,\nEM_ALT_VENDOR_ID AS EM_ALT_VENDOR_ID,\nEM_ALT_VENDOR_NAME AS EM_ALT_VENDOR_NAME,\nEM_ALT_VENDOR_COUNTRY_CD AS EM_ALT_VENDOR_COUNTRY_CD,\nEM_VENDOR_ID AS EM_VENDOR_ID,\nEM_VENDOR_NAME AS EM_VENDOR_NAME,\nEM_VENDOR_COUNTRY_CD AS EM_VENDOR_COUNTRY_CD,\nVENDOR_NAME_TXT AS VENDOR_NAME_TXT,\nMA_PCT_IND AS MA_PCT_IND,\nNEW_MA_AMT AS MA_AMT,\nMA_MAX_AMT AS MA_MAX_AMT,\nUPDATE_DT AS UPDATE_DT,\nLOAD_DT AS LOAD_DT FROM UPD_STRATEGY_10\"\"\")"]},"id":"MA_EVENT","position":{"x":0,"y":0},"type":"normalNode"}]}