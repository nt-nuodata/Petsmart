{"Edges":[{"transformationType":"Source Definition","id":"e-0","source":"","target":"SERVICES_MARGIN_RATE_PRE"},{"transformationType":"Source Qualifier","id":"e-1","source":"SERVICES_MARGIN_RATE_PRE","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_PRE"},{"transformationType":"Source Definition","id":"e-2","source":"","target":"SERVICES_MARGIN_RATE"},{"transformationType":"Source Qualifier","id":"e-3","source":"SERVICES_MARGIN_RATE","target":"SQ_Shortcut_to_SERVICES_MARGIN_RATE"},{"transformationType":"Joiner","id":"e-4","source":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_PRE","target":"JNR_SERVICES_MARGIN"},{"transformationType":"Joiner","id":"e-5","source":"SQ_Shortcut_to_SERVICES_MARGIN_RATE","target":"JNR_SERVICES_MARGIN"},{"transformationType":"Expression","id":"e-6","source":"JNR_SERVICES_MARGIN","target":"EXP_MARGIN_RATE"},{"transformationType":"Filter","id":"e-7","source":"EXP_MARGIN_RATE","target":"FIL_REJECTED"},{"transformationType":"Update Strategy","id":"e-8","source":"FIL_REJECTED","target":"UPD_STRATEGY"},{"transformationType":"Target Definition","id":"e-9","source":"UPD_STRATEGY","target":"SERVICES_MARGIN_RATE"}],"Nodes":[{"data":{"transformationType":"Source Definition","label":"SERVICES_MARGIN_RATE_PRE","queries":["df_0=spark.sql(\"\"\"\n    SELECT\n        WEEK_DT AS WEEK_DT,\n        LOCATION_ID AS LOCATION_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        MARGIN_RATE AS MARGIN_RATE,\n        monotonically_increasing_id() AS Monotonically_Increasing_Id \n    FROM\n        SERVICES_MARGIN_RATE_PRE\"\"\")","df_0.createOrReplaceTempView(\"SERVICES_MARGIN_RATE_PRE_0\")"]},"id":"SERVICES_MARGIN_RATE_PRE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_PRE","queries":["df_1=spark.sql(\"\"\"\n    SELECT\n        WEEK_DT AS WEEK_DT,\n        LOCATION_ID AS LOCATION_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        MARGIN_RATE AS MARGIN_RATE,\n        Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        SERVICES_MARGIN_RATE_PRE_0\"\"\")","df_1.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_PRE_1\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE_PRE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Definition","label":"SERVICES_MARGIN_RATE","queries":["df_2=spark.sql(\"\"\"\n    SELECT\n        WEEK_DT AS WEEK_DT,\n        LOCATION_ID AS LOCATION_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        MARGIN_RATE AS MARGIN_RATE,\n        UPDATE_TSTMP AS UPDATE_TSTMP,\n        LOAD_TSTMP AS LOAD_TSTMP,\n        monotonically_increasing_id() AS Monotonically_Increasing_Id \n    FROM\n        SERVICES_MARGIN_RATE\"\"\")","df_2.createOrReplaceTempView(\"SERVICES_MARGIN_RATE_2\")"]},"id":"SERVICES_MARGIN_RATE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_SERVICES_MARGIN_RATE","queries":["df_3=spark.sql(\"\"\"\n    SELECT\n        WEEK_DT AS WEEK_DT,\n        LOCATION_ID AS LOCATION_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        MARGIN_RATE AS MARGIN_RATE,\n        UPDATE_TSTMP AS UPDATE_TSTMP,\n        LOAD_TSTMP AS LOAD_TSTMP,\n        Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        SERVICES_MARGIN_RATE_2 \n    WHERE\n        SERVICES_MARGIN_RATE.WEEK_DT IN (\n            SELECT\n                DISTINCT WEEK_DT \n            FROM\n                SERVICES_MARGIN_RATE_PRE\n        )\"\"\")","df_3.createOrReplaceTempView(\"SQ_Shortcut_to_SERVICES_MARGIN_RATE_3\")"]},"id":"SQ_Shortcut_to_SERVICES_MARGIN_RATE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Joiner","label":"JNR_SERVICES_MARGIN","queries":["df_4=spark.sql(\"\"\"\n    SELECT\n        MASTER.WEEK_DT AS WEEK_DT,\n        MASTER.LOCATION_ID AS LOCATION_ID,\n        MASTER.SAP_DEPT_ID AS SAP_DEPT_ID,\n        MASTER.MARGIN_RATE AS MARGIN_RATE,\n        DETAIL.WEEK_DT AS WEEK_DT_OLD,\n        DETAIL.LOCATION_ID AS LOCATION_ID_OLD,\n        DETAIL.SAP_DEPT_ID AS SAP_DEPT_ID_OLD,\n        DETAIL.MARGIN_RATE AS MARGIN_RATE_OLD,\n        DETAIL.LOAD_TSTMP AS LOAD_TSTMP_OLD,\n        MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_PRE_1 MASTER \n    LEFT JOIN\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_3 DETAIL \n            ON MASTER.WEEK_DT = WEEK_DT_OLD \n            AND LOCATION_ID = LOCATION_ID_OLD \n            AND SAP_DEPT_ID = DETAIL.SAP_DEPT_ID\"\"\")","df_4.createOrReplaceTempView(\"JNR_SERVICES_MARGIN_4\")"]},"id":"JNR_SERVICES_MARGIN","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Joiner","label":"JNR_SERVICES_MARGIN","queries":["df_4=spark.sql(\"\"\"\n    SELECT\n        MASTER.WEEK_DT AS WEEK_DT,\n        MASTER.LOCATION_ID AS LOCATION_ID,\n        MASTER.SAP_DEPT_ID AS SAP_DEPT_ID,\n        MASTER.MARGIN_RATE AS MARGIN_RATE,\n        DETAIL.WEEK_DT AS WEEK_DT_OLD,\n        DETAIL.LOCATION_ID AS LOCATION_ID_OLD,\n        DETAIL.SAP_DEPT_ID AS SAP_DEPT_ID_OLD,\n        DETAIL.MARGIN_RATE AS MARGIN_RATE_OLD,\n        DETAIL.LOAD_TSTMP AS LOAD_TSTMP_OLD,\n        MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_PRE_1 MASTER \n    LEFT JOIN\n        SQ_Shortcut_to_SERVICES_MARGIN_RATE_3 DETAIL \n            ON MASTER.WEEK_DT = WEEK_DT_OLD \n            AND LOCATION_ID = LOCATION_ID_OLD \n            AND SAP_DEPT_ID = DETAIL.SAP_DEPT_ID\"\"\")","df_4.createOrReplaceTempView(\"JNR_SERVICES_MARGIN_4\")"]},"id":"JNR_SERVICES_MARGIN","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Expression","label":"EXP_MARGIN_RATE","queries":["df_5=spark.sql(\"\"\"\n    SELECT\n        IFF(ISNULL(WEEK_DT),\n        WEEK_DT_OLD,\n        WEEK_DT) AS WEEK_DT_OUT,\n        IFF(ISNULL(LOCATION_ID),\n        LOCATION_ID_OLD,\n        LOCATION_ID) AS LOCATION_ID_OUT,\n        IFF(ISNULL(SAP_DEPT_ID),\n        SAP_DEPT_ID_OLD,\n        SAP_DEPT_ID) AS SAP_DEPT_ID_OUT,\n        IFF(ISNULL(MARGIN_RATE),\n        0,\n        MARGIN_RATE) AS MARGIN_RATE_OUT,\n        current_timestamp AS UPDATE_TSTMP,\n        IFF(ISNULL(LOAD_TSTMP_OLD),\n        current_timestamp,\n        LOAD_TSTMP_OLD) AS LOAD_TSTMP,\n        IFF(ISNULL(WEEK_DT_OLD),\n        DD_INSERT,\n        IFF(IFF(ISNULL(MARGIN_RATE_OLD),\n        -1,\n        MARGIN_RATE_OLD) <> IFF(ISNULL(MARGIN_RATE),\n        -1,\n        MARGIN_RATE),\n        DD_UPDATE,\n        DD_REJECT)) AS UPDATE_STRATEGY,\n        Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        JNR_SERVICES_MARGIN_4\"\"\")","df_5.createOrReplaceTempView(\"EXP_MARGIN_RATE_5\")"]},"id":"EXP_MARGIN_RATE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Filter","label":"FIL_REJECTED","queries":["df_6=spark.sql(\"\"\"\n    SELECT\n        WEEK_DT AS WEEK_DT,\n        LOCATION_ID AS LOCATION_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        MARGIN_RATE AS MARGIN_RATE,\n        UPDATE_TSTMP AS UPDATE_TSTMP,\n        LOAD_TSTMP AS LOAD_TSTMP,\n        UPDATE_STRATEGY AS UPDATE_STRATEGY,\n        Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        EXP_MARGIN_RATE_5 \n    WHERE\n        UPDATE_STRATEGY <> DD_REJECT\"\"\")","df_6.createOrReplaceTempView(\"FIL_REJECTED_6\")"]},"id":"FIL_REJECTED","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Update Strategy","label":"UPD_STRATEGY","queries":["df_7=spark.sql(\"\"\"\n    SELECT\n        WEEK_DT AS WEEK_DT,\n        LOCATION_ID AS LOCATION_ID,\n        SAP_DEPT_ID AS SAP_DEPT_ID,\n        MARGIN_RATE AS MARGIN_RATE,\n        UPDATE_TSTMP AS UPDATE_TSTMP,\n        LOAD_TSTMP AS LOAD_TSTMP,\n        UPDATE_STRATEGY AS UPDATE_STRATEGY,\n        Monotonically_Increasing_Id AS Monotonically_Increasing_Id \n    FROM\n        FIL_REJECTED_6\"\"\")","df_7.createOrReplaceTempView(\"UPD_STRATEGY_7\")"]},"id":"UPD_STRATEGY","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Target Definition","label":"SERVICES_MARGIN_RATE","queries":["spark.sql(\"\"\"INSERT INTO SERVICES_MARGIN_RATE SELECT WEEK_DT AS WEEK_DT,\nLOCATION_ID AS LOCATION_ID,\nSAP_DEPT_ID AS SAP_DEPT_ID,\nMARGIN_RATE AS MARGIN_RATE,\nUPDATE_TSTMP AS UPDATE_TSTMP,\nLOAD_TSTMP AS LOAD_TSTMP FROM UPD_STRATEGY_7\"\"\")"]},"id":"SERVICES_MARGIN_RATE","position":{"x":0,"y":0},"type":"normalNode"}]}